{% extends "layout.html" %}

<!-- Breadcrumbs -->
{% block breadcrumbs %}
    <a href="{% url 'home' %}">Home</a>
    >
    <a href="{% url 'products:list' %}">Shop</a>
    >
    <a href="{% url 'products:category' view.kwargs.category %}">{{view.kwargs.category}}</a>
    > 
    <a href="{% url 'products:detail' view.kwargs.category product.productSlug %}">{{product.productName}}</a>
{% endblock %}
<!-- Breadcrumbs -->

{% block content %}
{% load product_extras %}
{% load humanize %}
    
    <div class="container">
        <div class="row">
            <div class="col-lg-2"><!-- small images column -->
                <div id="data-product-small-image" class="thumbnail">
                    {% for productImage in product1.first.productcolor_set.first.productimage_set.all %}
                    <img class="img-fluid" style="width:100%" src="{{ productImage.productImagePath.url }}" alt="">
                    {% endfor %}
                </div>
            </div>
            <div id="data-product-big-image" class="col-md-6"><!-- big image column -->
                <img style="width:100%" src="{{ product1.first.productcolor_set.first.productimage_set.first.productImagePath.url }}" alt="{{ product.productName }}">
            </div>
            <div class="col-md-4"><!-- details column -->
                <h2 id="product" data-product-slug="{{product1.first.productSlug}}">{{product1.first.productName}}</h2>

                {% if product.pricing_set.first.productID.pdiscount_set.first.pDiscountType %}<!-- pricing logic -->
                    <s>${{product.pricing_set.first.pricingBasePrice|floatformat:2}}</s>
                    <h4>${% get_discount_price product.pricing_set.first.pricingBasePrice as discounted_price %}{{discounted_price|floatformat:2}}</h4>
                {% else %}
                    <h4>${{product.pricing_set.first.pricingBasePrice|floatformat:2}}</h4>
                {% endif %}

                <form action="thiswillbeshopcart-update" method="POST" id="shopCartForm" data-sizes-url="{% url 'products:ajax_load_sizes' %}"><!-- cart form -->
                    <div id="color">
                        {% for productcolor in product1.first.productcolor_set.all %}
                        <label>
                            <input type="radio" name="color-selection" value="{{productcolor.colorID}}" autocomplete="off"> {{productcolor.colorID.colorName}}
                        </label>
                        {% endfor %}
                    </div>
                    <select id="size">
                            <option name="size-selection" value="{{productcolor.productColorName}}">{{productcolor.productColorName}}</li>
                    </select>
                    <button type="submit">Add to Bag</button>
                </form>

                <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
                <script>
                    $('input[type="radio"]').on("click", function() {
                        var url = $("#shopCartForm").attr("data-sizes-url");  // get the url of the `load_cities` view
                        var productColorID = $(this).val();  // get the selected country ID from the HTML input
                        var productSlug = $("#product").attr("data-product-slug");
                        $(this).checked = true;

                        $.ajax({                       // initialize an AJAX request
                            url: url,                    // set the url of the request (= localhost:8000/hr/ajax/load-cities/)

                            data: {
                            'productColorID': productColorID,       // add the country id to the GET parameters
                            'productSlug': productSlug       // add the country id to the GET parameters
                            },

                            success: function (data) {   // `data` is the return of the `load_cities` view function
                                // split response into array on newline
                                var array = data.split("\n");
                                // initialize containers for sizes and images
                                var sizeArray = [];
                                var imgArray = [];
                                // for loop to get size options and image tags into array
                                for(var x in array){

                                    if(array[x].includes("<option") == true){
                                        sizeArray[x] = array[x];
                                    }
                                    else if(array[x].includes("<img") == true){
                                        imgArray[x] = array[x];
                                    }

                                }
                                $("#size").html(sizeArray);  // replace the contents of the city input with the data that came from the server
                                $("#data-product-small-image").html(imgArray)
                            }
                        });

                    });
                </script>
                <p>{{product.productDescription}}</p>
                <p>CartID: {{ shopcart }}</p>
                {% for item in shopcart.shopCartItems.all %}
                    <p>{{ item.productID }}</p>
                {% endfor %}
            </div>
        </div>
    </div> <!-- /container -->

{% endblock %}